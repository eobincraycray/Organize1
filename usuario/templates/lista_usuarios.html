{% load static %}
<!DOCTYPE html>
<html lang="pt_BR">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Tarefas - Organize</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="{% static 'img/favicon.png' %}" rel="icon">
  <link href="{% static 'img/apple-touch-icon.png' %}" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Inter:wght@100;200;300;400;500;600;700;800;900&family=Nunito:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/bootstrap-icons/bootstrap-icons.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/aos/aos.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/glightbox/css/glightbox.min.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/swiper/swiper-bundle.min.css' %}" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="{% static 'css/main.css' %}" rel="stylesheet">
</head>

<body class="index-page">

  <header id="header" class="header d-flex align-items-center fixed-top">
    <div class="header-container container-fluid container-xl position-relative d-flex align-items-center justify-content-between">

      <!-- Logo da plataforma -->
      <a href="#" class="logo d-flex align-items-center me-auto me-xl-0">
        <img src="{% static 'img\logoorganize.svg' %}" alt="Logo do site" class="img-fluid">
      </a>

      <!-- Menu de navegação -->
      <nav id="navmenu" class="navmenu d-flex align-items-center">
        <ul class="d-none d-xl-flex">
          <li><a href="{% url 'usuario:lista_usuarios' %}" class="active">Usuários</a></li>
          <li><a href="{% url 'tarefa:lista_todas_tarefas' %}">Tarefas</a></li>
          <li><a href="{% url 'tarefa:lista_categorias' %}">Categoria</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>

      <!-- Círculo do perfil de usuário -->
      <div class="user-profile position-relative">
        <div class="profile-circle" onclick="toggleDropdown()">
          <!-- As iniciais serão inseridas via JS -->
          {{ username|slice:":2"|upper }}
        </div>
        <div id="profileDropdown" class="dropdown-menu dropdown-hidden">
          <a href="{% url 'usuario:perfil' %}">Perfil</a>
          <form method="POST" action="{% url 'usuario:logout' %}">
            {% csrf_token %}
            <button type="submit">Sair</button>
          </form>
        </div>
      </div>
    </div>
  </header>

  <main class="main">

    <!-- Page Title -->
    <div class="page-title light-background">
      <div class="container">
        <h1>Gerenciador da plataforma</h1>
      </div>
    </div><!-- End Page Title -->

    <!-- Service Details Section -->
    <section id="service-details" class="service-details section">

      <div class="container">

        <div class="row gy-5">

          <div class="col-lg-4" data-aos="fade-up" data-aos-delay="100">

            <div class="service-box">
              <h4>Verificar</h4>
              <div class="services-list">
                <a href="{% url 'usuario:lista_usuarios' %}" class="active"><i class="bi bi-arrow-right-circle"></i><span>Usuários</span></a>
                <a href="{% url 'tarefa:lista_todas_tarefas' %}"><i class="bi bi-arrow-right-circle"></i><span>Tarefas</span></a>
                <a href="{% url 'tarefa:lista_categorias' %}"><i class="bi bi-arrow-right-circle"></i><span>Categoria</span></a>
              </div>
            </div><!-- End Services List -->

            <div class="service-box">
              <h4>Area de Download</h4>
              <div class="download-catalog">
                <a href="#"><i class="bi bi-filetype-pdf"></i><span>Relatório</span></a>
              </div>
            </div><!-- End Services List -->

            <div class="help-box d-flex flex-column justify-content-center align-items-center">
              <i class="bi bi-headset help-icon"></i>
              <h4>Alguma Duvida?</h4>
              <h4>Contate o DEV</h4>
              <p class="d-flex align-items-center mt-2 mb-0"><i class="bi bi-telephone me-2"></i> <span>+1 5589 55488 55</span></p>
              <p class="d-flex align-items-center mt-1 mb-0"><i class="bi bi-envelope me-2"></i> <a href="mailto:contact@example.com">contact@example.com</a></p>
            </div>

          </div>

          <div class="col-lg-8 ps-lg-5" data-aos="fade-up" data-aos-delay="200">
            <div class="container mt-4">
              <div class="service-box p-4">
                <div class="d-flex justify-content-between mb-3 flex-wrap gap-3">
                  <h4 class="mb-0">Lista de Usuários</h4>
                  <input type="text" id="busca" class="form-control w-auto" style="min-width: 250px" placeholder="Buscar...">
                </div>

                <div class="table-responsive">
                  <table class="table align-middle">
                    <thead class="table-light">
                      <tr>
                        <th>#</th>
                        <th>Nome</th>
                        <th>Email</th>
                        <th>Ações</th>
                      </tr>
                    </thead>
                    <tbody id="tabela-conteudo">
                      {% for user in usuarios %}
                      <tr>
                        <td>{{ user.id }}</td>
                        <td>{{ user.get_full_name|default:user.username }}</td>
                        <td>{{ user.email }}</td>
                        <td>
                          <a href="{% url 'usuario:editar_usuario' user.id %}" class="btn btn-sm btn-warning" title="Editar"><i class="bi bi-pencil"></i></a>
                          <a href="{% url 'usuario:excluir_usuario' user.id %}"
                            class="btn btn-sm btn-danger"
                            onclick="return confirm('Tem certeza que deseja excluir este usuário?')"
                            title="Excluir">
                            <i class="bi bi-trash"></i>
                          </a>
                           <a href="{% url 'usuario:visualizar_usuario' user.id %}" class="btn btn-sm btn-info" title="Visualizar"><i class="bi bi-eye"></i>
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>

                <div class="d-flex justify-content-between align-items-center mt-3 flex-wrap gap-3">
                  <div></div>
                  <a href="{% url 'usuario:criar_usuario' %}" class="btn" style="background-color: #a259ff; color: white">Adicionar</a>
                </div>
              </div>
            </div>

                 
          </div>
          </div>

        </div>

      </div>

    </section><!-- /Service Details Section -->

  </main>

  <!-- Rodapé -->
  <footer id="footer" class="footer">
    <div class="container text-center">
      <a href="{% url 'tarefa:home' %}" class="logo d-flex justify-content-center mb-3">
        <img src="{% static 'img/logoorganize.svg' %}" alt="Logo do site" style="max-height: 40px;">
      </a>

      <div class="footer-contact mb-3">
        <p><strong>Telefone:</strong> +55 77 9.9999-9999</p>
        <p><strong>Email:</strong> info@example.com</p>
      </div>

      <div class="social-links d-flex justify-content-center mb-3">
        <a href="#"><i class="bi bi-twitter-x"></i></a>
        <a href="#"><i class="bi bi-facebook"></i></a>
        <a href="#"><i class="bi bi-instagram"></i></a>
        <a href="#"><i class="bi bi-linkedin"></i></a>
      </div>

      <div class="copyright">
        <p>© <span>Direitos Autorais</span> <strong class="px-1">binho_ads</strong> <span>Todos os direitos reservados</span></p>
        <div class="credits">
          Desenvolvido por <a href="#">binho_ads</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
  <script src="{% static 'vendor/php-email-form/validate.js' %}"></script>
  <script src="{% static 'vendor/aos/aos.js' %}"></script>
  <script src="{% static 'vendor/glightbox/js/glightbox.min.js' %}"></script>
  <script src="{% static 'vendor/swiper/swiper-bundle.min.js' %}"></script>
  <script src="{% static 'vendor/purecounter/purecounter_vanilla.js' %}"></script>

  <!-- Main JS File -->
  <script src="{% static 'js/main.js' %}"></script>

  <script>
  function toggleDropdown() {
    const menu = document.getElementById("profileDropdown");
    menu.style.display = menu.style.display === "block" ? "none" : "block";
  }

  // Fecha o menu dropdown se clicar fora
  window.onclick = function(event) {
    if (!event.target.matches('.profile-circle')) {
      const dropdown = document.getElementById("profileDropdown");
      if (dropdown && dropdown.style.display === "block") {
        dropdown.style.display = "none";
      }
    }
  }

  // Exemplo de como inserir as iniciais dinamicamente
  const fullName = "Ana Beatriz"; // Simule pegar do backend
  const initials = fullName.split(" ").map(n => n[0]).join("").toUpperCase();
  document.addEventListener("DOMContentLoaded", () => {
    document.querySelector(".profile-circle").textContent = initials;
  });
</script>

<!-- Teste do js da lista-->
<script>
  const dados = {
    usuarios: [
      { id: 1, nome: "João Silva", email: "joao@example.com" },
      // ... simular mais dados ...
    ],
    tarefas: [
      { id: 1, titulo: "Tarefa 1", categoria: "Estudo" },
      { id: 2, titulo: "Tarefa 2", categoria: "Trabalho" },
    ],
    categorias: [
      { id: 1, nome: "Estudo" },
      { id: 2, nome: "Trabalho" },
    ]
  };

  let tipoAtual = 'usuarios';
  let paginaAtual = 0;
  const porPagina = 20;

  function exibirTabela(tipo, pagina = 0, busca = "") {
    tipoAtual = tipo;
    paginaAtual = pagina;
    document.getElementById("lista-titulo").textContent = `Lista de ${tipo.charAt(0).toUpperCase() + tipo.slice(1)}`;

    const dadosFiltrados = dados[tipo].filter(el => {
      return Object.values(el).some(v => v.toString().toLowerCase().includes(busca.toLowerCase()));
    });

    const inicio = pagina * porPagina;
    const fim = inicio + porPagina;
    const paginaDados = dadosFiltrados.slice(inicio, fim);

    const tbody = document.getElementById("tabela-conteudo");
    tbody.innerHTML = "";

    paginaDados.forEach((el, i) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${el.id}</td>
        <td>${el.nome || el.titulo}</td>
        <td>${el.email || el.categoria || "-"}</td>
        <td>
          <button class="btn btn-sm btn-primary" title="Visualizar"><i class="bi bi-eye"></i></button>
          <button class="btn btn-sm btn-warning" title="Editar"><i class="bi bi-pencil"></i></button>
          <button class="btn btn-sm btn-danger" title="Excluir"><i class="bi bi-trash"></i></button>
        </td>
      `;
      tbody.appendChild(tr);
    });

    const paginacao = document.getElementById("paginacao");
    paginacao.innerHTML = "";
    const totalPaginas = Math.ceil(dadosFiltrados.length / porPagina);
    for (let i = 0; i < totalPaginas; i++) {
      const li = document.createElement("li");
      li.className = `page-item ${i === pagina ? 'active' : ''}`;
      li.innerHTML = `<a class="page-link" href="#" style="color: #a259ff">${i}</a>`;
      li.onclick = () => exibirTabela(tipo, i, document.getElementById("busca").value);
      paginacao.appendChild(li);
    }
  }

  document.getElementById("busca").addEventListener("input", e => {
    exibirTabela(tipoAtual, 0, e.target.value);
  });

  document.querySelectorAll(".services-list a").forEach(el => {
    el.addEventListener("click", e => {
      e.preventDefault();
      document.querySelectorAll(".services-list a").forEach(a => a.classList.remove("active"));
      el.classList.add("active");
      const tipo = el.textContent.trim().toLowerCase();
      exibirTabela(tipo);
    });
  });

  document.getElementById("btn-adicionar").addEventListener("click", () => {
    alert(`Adicionar novo item para: ${tipoAtual}`);
    // Aqui você pode abrir um modal ou redirecionar para a página de criação
  });

  // Inicializar
  exibirTabela("usuarios");
</script>




</body>

</html>